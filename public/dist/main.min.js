!function(){function e(e,t,r){t.state("home",{url:"/",templateUrl:"./scripts/home/home.tpl.html"}).state("login",{url:"/signin",templateUrl:"./scripts/login/login.tpl.html",controller:"LoginPageController",controllerAs:"vm"}).state("registration",{url:"/registration",templateUrl:"./scripts/registration/registration.tpl.html",controller:"RegistrationPageController",controllerAs:"vm"}).state("main",{url:"","abstract":!0,templateUrl:"./scripts/main/main.tpl.html",controller:"MainPageController",controllerAs:"vm"}).state("main.lists",{url:"/user/:username",templateUrl:"./scripts/main/lists/lists.tpl.html",controller:"ListsPageController",controllerAs:"vm"}).state("main.profile",{url:"/profile",templateUrl:"./scripts/main/profile/profile.tpl.html",controller:"ProfilePageController",controllerAs:"vm"}).state("notfound",{url:"/404",templateUrl:"./scripts/404/404.tpl.html"}),r.otherwise("/404"),e.html5Mode(!0)}function t(e,t,r){e.$on("$stateChangeSuccess",function(e,t){var r=t.name.split("."),n=r[r.length-1];"lists"!==n&&(document.body.className=n+"-page")})}angular.module("trelloProject",["ui.router","ngResource","ui.tree","ngScrollable","monospaced.elastic"]).config(e).run(t),e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider"],t.$inject=["$rootScope","$state","$window"]}(),function(){"use strict";function e(e,t,r,n){function o(){n.get({},function(e){s.avatar=e.user.avatar,s.name=e.user.name})}function a(){s.showDropdown=!1}function i(){delete r.localStorage.token,delete r.localStorage.user,t.go("home")}var s=this;s.showDropdown=!1,s.closeDropdown=a,s.logout=i,e.$on("reloadUserData",o),o()}angular.module("trelloProject").controller("MainPageController",e),e.$inject=["$scope","$state","$window","UserService"]}(),function(){"use strict";function e(e,t,r){function n(n){if(a.submitted=!0,n){var o={email:a.email,password:a.password};r.login({},o,function(r){e.localStorage.token=r.token,e.localStorage.user=r.user,t.go("main.lists",{username:r.user})},function(t){delete e.localStorage.token,a.message=t.data.message})}}function o(){a.message=null}var a=this;a.login=n,a.clearMessageError=o}angular.module("trelloProject").controller("LoginPageController",e),e.$inject=["$window","$state","AuthService"]}(),function(){"use strict";function e(e,t,r){function n(n){if(a.submitted=!0,n){var o={username:a.name,email:a.email,password:a.password};r.save({},o,function(r){e.localStorage.token=r.token,e.localStorage.user=a.name,t.go("main.lists",{username:a.name})},function(t){delete e.localStorage.token,a.message=t.data.message})}}function o(){a.message&&(a.message=null)}var a=this;a.registration=n,a.clearMessageError=o}angular.module("trelloProject").controller("RegistrationPageController",e),e.$inject=["$window","$state","AuthService"]}(),function(){"use strict";function e(e){e.interceptors.push("AuthInterceptor")}function t(e,t,r,n){return{request:function(e){return e.headers=e.headers||{},r.localStorage.token&&(e.headers.Authorization="Bearer "+r.localStorage.token),e},responseError:function(e){return 401===e.status?n.get("$state").go("home"):404===e.status&&n.get("$state").go("notfound"),t.reject(e)}}}angular.module("trelloProject").factory("AuthInterceptor",t).config(e),e.$inject=["$httpProvider"],t.$inject=["$rootScope","$q","$window","$injector"]}(),function(){"use strict";function e(e){return e("/auth/:type",{type:"@type"},{save:{method:"POST",params:{type:"signup"}},login:{method:"POST",params:{type:"login"}}})}angular.module("trelloProject").factory("AuthService",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e){var t=e("/api/user/:user/lists/:list/cards/:card",{user:"@user",list:"@list",card:"@card"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}});return t}angular.module("trelloProject").factory("CardService",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e){var t=e("/api/user/:user/lists/:id:type",{user:"@user",id:"@id",type:"@type"},{query:{method:"GET",isArray:!1},update:{method:"PUT"},sort:{method:"POST",params:{type:"sort"}}});return t}angular.module("trelloProject").factory("ListService",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e){var t=e("/api/user/:type",{type:"@type"},{query:{method:"GET",isArray:!1},avatar:{method:"PUT",params:{type:"avatar"}},background:{method:"PUT",params:{type:"background"}},update:{method:"PUT"}});return t}angular.module("trelloProject").factory("UserService",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e,t,r){function n(){r.get({user:c},function(e){l.lists=e.lists,document.body.className=e.background,s()})}function o(){l.newListTitle&&r.save({user:c},{title:l.newListTitle},function(e){l.lists=e.lists,l.focusOn=!0,l.newListTitle=null,s()})}function a(){l.visibleNewList=!0,l.focusOn=!0}function i(){r.get({user:c},function(e){l.lists=e.lists,s()})}function s(){var t=290*(l.lists.length+1);document.querySelector(".lists__wrapper").style.width=t+"px",e.$broadcast("content.changed")}var l=this,c=t.username;l.visibleNewList=!1,l.createNewList=o,l.setVisibleNewList=a,l.reloadLists=i,n(),e.listOptions={accept:function(e,t,r){var n=e.$element.hasClass("list__wrapper"),o=t.$element.hasClass("list__placeholder"),a=e.$element.hasClass("list__card"),i=t.$element.hasClass("card__placeholder");return n===o?!0:a===i?!0:void 0},dropped:function(){r.sort({user:c},{lists:l.lists},function(e){})}}}angular.module("trelloProject").controller("ListsPageController",e),e.$inject=["$scope","$stateParams","ListService"]}(),function(){"use strict";function e(e,t,r){function n(){r.get({},function(e){i.username=e.user.name,i.email=e.user.email,i.avatar=e.user.avatar})}function o(n){if(n){var o={name:i.username,email:i.email};r.update({},o,function(r){i.messageDone=r.message,t.localStorage.user=i.username,e.$emit("reloadUserData")},function(e){i.messageError=e.data.message})}}function a(t){var n;0!==t.type.localeCompare("image/jpeg")&&0!==t.type.localeCompare("image/png")&&alert("Image file format must be jpeg or png!"),n=new FileReader,n.onload=function(t){r.avatar({},{avatar:t.target.result},function(t){i.avatar=t.avatar,e.$emit("reloadUserData")})},n.readAsDataURL(t)}var i=this;i.updateData=o,i.changeAvatar=a,n()}angular.module("trelloProject").controller("ProfilePageController",e),e.$inject=["$scope","$window","UserService"]}(),function(){"use strict";function e(){var e={restrict:"E",replace:!0,scope:{data:"=",listId:"=",reload:"&"},templateUrl:"./scripts/common/directives/card/card.tpl.html",controller:t,controllerAs:"vm",bindToController:!0};return e}function t(e,t,r){function n(){c.showDropdown=!c.showDropdown}function o(){c.showDropdown=!1}function a(){c.data.text=l,c.changeCardText=!1}function i(){r["delete"]({user:u,list:m,card:d},function(e){c.reload()})}function s(){c.data.text&&r.update({user:u,list:m,card:d},{text:c.data.text},function(e){c.changeCardText=!1})}var l,c=this,u=t.username,d=c.data._id,m=c.listId;c.removeCard=i,c.editCard=n,c.closeDropdown=o,c.closeEditingCard=a,c.saveEditingCard=s,e.$watch("vm.changeCardText",function(e){e===!0&&(l=c.data.text)})}angular.module("trelloProject").directive("card",e),t.$inject=["$scope","$stateParams","CardService"]}(),function(){"use strict";function e(e,t){function r(r,n,o){var a=t(o.clickOutside),i=function(e){var t=n[0].contains(e.target);if(e&&e.target&&!t)return r.$apply(function(){return a(r)})};e.on("click",i),r.$on("$destroy",function(){e.off("click",i)})}var n={restrict:"A",link:r};return n}angular.module("trelloProject").directive("clickOutside",e),e.$inject=["$document","$parse"]}(),function(){"use strict";function e(e,t){function r(r,n,o){function a(e){t.background({background:e.target.className,user:i},function(t){document.body.className=e.target.className})}var i=e.username;n.bind("click",a)}var n={restrict:"A",link:r};return n}angular.module("trelloProject").directive("changeBackground",e),e.$inject=["$stateParams","UserService"]}(),function(){"use strict";function e(e){function t(t,r,n){t.$watch("trigger",function(n){n&&e(function(){r[0].focus(),t.trigger=!1})})}var r={restrict:"A",scope:{trigger:"=customFocus"},link:t};return r}angular.module("trelloProject").directive("customFocus",e),e.$inject=["$timeout"]}(),function(){"use strict";function e(){var e={restrict:"E",replace:!0,scope:{data:"=",reload:"&"},templateUrl:"./scripts/common/directives/list/list.tpl.html",controller:t,controllerAs:"vm",bindToController:!0};return e}function t(e,t,r,n){function o(){m.showDropdown=!1}function a(){m.visibleNewCard=!0,m.focusOn=!0}function i(){r["delete"]({user:f,id:g},function(e){m.reload()})}function s(){if(m.newCardsText){({text:m.newCardsText});n.save({user:f,list:g},{text:m.newCardsText},function(e){m.data.cards=e.cards,m.focusOn=!0,m.newCardsText=null})}}function l(e){e&&r.update({user:f,id:g},{title:m.data.title},function(e){m.visibleEditTitle=!1})}function c(){m.visibleEditTitle=!1,m.data.title=d}function u(){n.get({user:f,list:g},function(e){m.data.cards=e.cards})}var d,m=this,f=t.username,g=m.data._id;m.visibleNewCard=!1,m.saveNewTitle=l,m.closeDropdown=o,m.createNewCard=s,m.showNewCardInput=a,m.removeList=i,m.cancelEditTitle=c,m.reloadCard=u,e.$watch("vm.visibleEditTitle",function(e){e===!0&&(d=m.data.title)})}angular.module("trelloProject").directive("list",e),t.$inject=["$scope","$stateParams","ListService","CardService"]}(),function(){"use strict";function e(e){function t(t,r,n){t.$last===!0&&e(function(){t.$emit("ngRepeatFinished")})}var r={restrict:"A",link:t};return r}angular.module("trelloProject").directive("onFinishRender",e),e.$inject=["$timeout"]}(),function(){"use strict";function e(e){function t(t,r,n){function o(e){t.$apply(function(){a(t,{image:e.target.files[0]})})}var a=e(n.fileReader);r.bind("change",o)}var r={restrict:"A",link:t};return r}angular.module("trelloProject").directive("fileReader",e),e.$inject=["$parse"]}();
//# sourceMappingURL=main.min.js.map
